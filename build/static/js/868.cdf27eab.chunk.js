"use strict";(self.webpackChunkdelivery_admin=self.webpackChunkdelivery_admin||[]).push([[868],{713:function(e,t,n){n.d(t,{Pk:function(){return d},i$:function(){return l},uJ:function(){return r},vc:function(){return i}});var o=n(2426),a=n.n(o),r=[{id:2,name:"ADMIN"},{id:3,name:"COURIER"}],d=function(e){return e&&e>=a()().endOf("day")},i="DD.MM.YYYY",l="DD.MM.YYYY HH:mm:ss"},868:function(e,t,n){n.r(t),n.d(t,{default:function(){return P}});var o=n(1413),a=n(9439),r=n(2791),d=n(3695),i=n(6106),l=n(914),s=n(7309),u=n(1520),c=n(5485),p=n(1756),f=n(3168),g=n(4925),m=n(2972),h=n(3734),v=n(1095),Z=n(2862),x=n(7083),y=n(3344),j=n(9516),k=n(9336),C=n(5010),b=n(8885),I=n(3405),M=n(4075),S=n(184),q=function(e){var t=e.open,n=e.setOpen,o=e.coords,d=e.setCoords,i=e.address,l=e.setAddress,s=(0,r.useRef)(),u=(0,r.useRef)(),c=(0,r.useRef)(),p=(0,r.useState)(!1),f=(0,a.Z)(p,2),g=f[0],m=f[1],h=function(e){var t,n;d(e),null===s||void 0===s||null===(t=s.current)||void 0===t||null===(n=t.geocode(e))||void 0===n||n.then((function(e){var t=e.geoObjects.get(0),n=[(t.getLocalities().length,t.getAddressLine())].filter(Boolean).join(", ");l(n)}))};return(0,S.jsx)(b.Z,{width:"45%",style:{padding:0},title:"Xaritadan belgilash: ".concat(i),placement:"right",onClose:function(){n(!1)},open:t,children:(0,S.jsx)(x.Z,{spinning:!g,children:(0,S.jsx)("div",{className:"location",children:(0,S.jsx)(I.Yy,{query:{apikey:M.Z.YnxMapKey},children:(0,S.jsxs)(I.D5,{defaultState:{center:[55.751574,37.573856],zoom:10,controls:["zoomControl","fullscreenControl"]},className:"mapYandex",onClick:function(e){var t,n,o=e.get("coords");c.current?c.current.geometry.setCoordinates(o):(c.current=function(e){if(s.current)return new s.current.Placemark(e)}(o),null===(t=u.current)||void 0===t||t.geoObjects.add(c.current),null===(n=c.current)||void 0===n||n.events.add("dragend",(function(){var e;h(null===(e=c.current)||void 0===e?void 0:e.geometry.getCoordinates())})));h(o)},onLoad:function(e){e&&(s.current=e,e.ready((function(){return m(!0)})))},modules:["geoObject.addon.balloon","Placemark","geocode","geoObject.addon.hint","borders","ObjectManager","geoObject.addon.editor","control.ZoomControl","control.FullscreenControl"],children:[(0,S.jsx)(I.ah,{options:{draggable:!0},geometry:o}),(0,S.jsx)(I.Bo,{options:{float:"left"}}),(0,S.jsx)(I.Sj,{options:{float:"right"}})]})})})})})},w=n(763),z=["updateData","t","productData","modalType"],O=h.Z.Option,T={labelCol:{span:8},wrapperCol:{span:14}},D=function(e){var t,n,i,l,u,c=e.updateData,p=e.t,f=(e.productData,e.modalType),b=(0,g.Z)(e,z),I=(0,r.useState)(null===c||void 0===c||null===(t=c.data)||void 0===t||null===(n=t.products)||void 0===n||null===(i=n.product)||void 0===i?void 0:i.name),M=(0,a.Z)(I,2),D=M[0],F=M[1],Y=(0,m.HH)(D),L=(0,C.I0)(),P=(0,r.useState)(!1),X=(0,a.Z)(P,2),A=X[0],R=X[1],H=(0,r.useState)([]),N=(0,a.Z)(H,2),$=N[0],_=N[1],B=(0,r.useState)(""),E=(0,a.Z)(B,2),J=E[0],K=E[1],V=v.Z.useForm(),Q=(0,a.Z)(V,1)[0],U=(0,m.kx)(),G=(0,a.Z)(U,2),W=G[0],ee=G[1],te=(0,m.qH)(),ne=(0,a.Z)(te,2),oe=ne[0],ae=ne[1],re=function(){F(""),_([]),K(""),Q.resetFields()};(0,r.useEffect)((function(){return c&&"update"===f&&(F(c.data.products[0].product.name),_([c.data.location.latitude,c.data.location.longitude]),K(c.data.location.address),Q.setFieldsValue({productId:c.data.products[0].product.id,quantity:c.data.products[0].quantity})),function(){return re()}}),[c,f]);var de=(0,w.debounce)((function(e){F(e)}),300),ie=null===Y||void 0===Y||null===(l=Y.data)||void 0===l||null===(u=l.data)||void 0===u?void 0:u.map((function(e){return(0,S.jsx)(O,{value:e.id,children:e.name},e.id)})),le=(0,o.Z)({onOk:function(){Q.validateFields().then((function(e){console.log("data: ",e),console.log("coords: ",$),console.log("address: ",J);var t={data:{products:[{productId:e.productId.value,quantity:e.quantity}],location:{latitude:$[0],longitude:$[1],address:J}},courierId:1,clientId:1};if(console.log("formData: ",t),"update"===f)W({id:c.id,value:e}).unwrap().then((function(e){200===e.statusCode&&(d.ZP.success("Muvaffaqiyati tahrirlandi."),L((0,k.sI)({openModal:!1,modalType:""})),Q.resetFields())})).catch((function(e){d.ZP.error("Xatolik yuz berdi. Xatolik: ".concat(e.message))}));else if("create"===f){oe(t).unwrap().then((function(e){200===e.statusCode&&(d.ZP.success("Muvaffaqiyati saqlandi."),L((0,k.sI)({openModal:!1,modalType:""})),re())})).catch((function(e){d.ZP.error("Xatolik yuz berdi. Xatolik: ".concat(e.message))}))}})).catch((function(e){return console.log("Form error: ",e)}))},confirmLoading:!!f.length&&("create"===f?ae.isLoading:ee.isLoading),forceRender:!0},b);return console.log("productOptions: ",ie),(0,S.jsx)(S.Fragment,{children:(0,S.jsxs)(Z.Z,(0,o.Z)((0,o.Z)({},le),{},{children:[(0,S.jsxs)(v.Z,(0,o.Z)((0,o.Z)({},T),{},{form:Q,name:"basic",layout:"horizontal",autoComplete:"off",children:[(0,S.jsx)(v.Z.Item,{name:"productId",label:p("menus.products"),rules:[{required:!0,message:p("ordersMenu.select_product")}],children:(0,S.jsx)(h.Z,{labelInValue:!0,mode:"multiple",allowClear:!0,showSearch:!0,placeholder:"Select products",value:D,onSearch:de,filterOption:!1,notFoundContent:Y.isLoading?(0,S.jsx)(x.Z,{size:"small"}):null,children:ie})}),(0,S.jsx)(v.Z.Item,{name:"quantity",label:p("ordersMenu.quantity"),rules:[{required:!0,message:"Miqdorini kiriting"}],children:(0,S.jsx)(y.Z,{style:{width:"100%"},placeholder:"Miqdorini kiriting"})}),(0,S.jsx)(v.Z.Item,{name:"map",label:"Manzil",rules:[{required:0===$.length,message:"Xatolik"}],children:(0,S.jsxs)(s.Z,{block:!0,onClick:function(){R(!0)},children:["Xaritadan belgilash",(0,S.jsx)(j.Z,{})]})})]})),(0,S.jsx)(q,{open:A,setOpen:R,coords:$,setCoords:_,address:J,setAddress:K})]}))})},F=n(713),Y=n(2426),L=n.n(Y),P=function(){var e,t,n,g,h,v,Z=(0,f.$)().t,x=(0,C.v9)((function(e){return e.orderSlice})),y=x.openModal,j=x.modalType,b=(0,C.I0)(),I=(0,r.useState)({page:1,pageSize:20}),M=(0,a.Z)(I,2),q=M[0],w=M[1],z=(0,m.FA)(q),O=(0,m.OT)(q),T=(0,m.tL)(),Y=(0,a.Z)(T,2),P=Y[0],X=Y[1].isLoading,A=(0,r.useState)(),R=(0,a.Z)(A,2),H=R[0],N=R[1],$=[{title:"\u2116",dataIndex:"id",key:"id",width:"5%",render:function(e,t,n){return(0,S.jsx)("span",{children:n+1})}},{title:Z("time"),dataIndex:"createdAt",key:"createdAt",render:function(e,t){return L()(e).format(F.i$)}},{title:Z("productsMenu.price"),dataIndex:"total",key:"total",render:function(e,t){return e}},{title:Z("ordersMenu.address"),dataIndex:"data",key:"data",render:function(e,t){return e.location.address}},{title:Z("actions"),key:"action",width:"20%",render:function(e,t,n){return(0,S.jsxs)(i.Z,{wrap:!1,gutter:5,children:[(0,S.jsx)(l.Z,{children:(0,S.jsx)(s.Z,{size:"small",type:"primary",ghost:!0,onClick:function(){return N(t),void b((0,k.sI)({openModal:!0,modalType:"update"}))},children:Z("edit")})}),(0,S.jsx)(l.Z,{children:(0,S.jsx)(u.Z,{okText:Z("yes"),cancelText:Z("no"),onConfirm:function(){return t=e.id,void P({id:t}).unwrap().then((function(e){200===e.statusCode&&d.ZP.success("Muvaffaqiyati o'chirildi.")})).catch((function(e){d.ZP.error("Xatolik yuz berdi. Xatolik: ".concat(e.message))}));var t},title:Z("sureDelete"),children:(0,S.jsx)(s.Z,{size:"small",danger:!0,disabled:X,children:Z("delete")})})})]})}}],_={total:(null===(e=O.data)||void 0===e||null===(t=e.meta)||void 0===t?void 0:t.total)*(null===(n=O.data)||void 0===n||null===(g=n.meta)||void 0===g?void 0:g.pagesize),page:q.page,pageSizeOptions:["20","50","100"],showQuickJumper:!0,showSizeChanger:!0,pageSize:q.pageSize,current:q.page,onChange:function(e,t){w({page:e,pageSize:t})}},B={title:Z("update"===j?"edit":"add"),open:y,okText:Z("update"===j?"edit":"add"),cancelText:Z("close"),onCancel:function(){b((0,k.sI)({openModal:!1,modalType:""})),N(void 0)}};return(0,S.jsxs)(S.Fragment,{children:[(0,S.jsxs)(i.Z,{children:[(0,S.jsx)(l.Z,{span:20,children:(0,S.jsx)(c.Z.Title,{level:2,children:Z("menus.orders")})}),(0,S.jsx)(l.Z,{span:4,children:(0,S.jsx)(s.Z,{type:"primary",onClick:function(){return b((0,k.sI)({openModal:!0,modalType:"create"}))},children:Z("add")})})]}),(0,S.jsx)(p.Z,{columns:$,dataSource:null===(h=O.data)||void 0===h?void 0:h.data,loading:O.isFetching,rowKey:function(e){return e.id},pagination:_}),(0,S.jsx)(D,(0,o.Z)({updateData:H,t:Z,modalType:j,productData:null===(v=z.data)||void 0===v?void 0:v.data},B))]})}}}]);
//# sourceMappingURL=868.cdf27eab.chunk.js.map