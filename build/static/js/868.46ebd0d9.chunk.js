"use strict";(self.webpackChunkdelivery_admin=self.webpackChunkdelivery_admin||[]).push([[868],{713:function(e,t,n){n.d(t,{Pk:function(){return i},i$:function(){return s},uJ:function(){return o},vc:function(){return d}});var a=n(2426),r=n.n(a),o=[{id:2,name:"ADMIN"},{id:3,name:"COURIER"}],i=function(e){return e&&e>=r()().endOf("day")},d="DD.MM.YYYY",s="DD.MM.YYYY HH:mm:ss"},868:function(e,t,n){n.r(t),n.d(t,{default:function(){return J}});var a=n(1413),r=n(9439),o=n(2791),i=n(3695),d=n(6106),s=n(914),u=n(7309),l=n(1520),c=n(5485),p=n(9184),f=n(3168),m=n(4925),h=n(2972),g=n(3734),x=n(1095),y=n(2862),Z=n(2126),v=n(3099),j=n(2143),k=n(9286),C=n(9516),M=n(9336),S=n(5010),b=n(8885),I=n(7083),z=n(3405),q=n(4075),O=n(184),T=function(e){var t=e.open,n=e.setOpen,a=e.coords,i=e.setCoords,d=e.address,s=e.setAddress,u=e.t,l=(0,o.useRef)(),c=(0,o.useRef)(),p=(0,o.useRef)(),f=(0,o.useState)(!1),m=(0,r.Z)(f,2),h=m[0],g=m[1],x=function(e){var t,n;i(e),null===l||void 0===l||null===(t=l.current)||void 0===t||null===(n=t.geocode(e))||void 0===n||n.then((function(e){var t=e.geoObjects.get(0),n=[(t.getLocalities().length,t.getAddressLine())].filter(Boolean).join(", ");s(n)}))};return(0,O.jsx)(b.Z,{width:"45%",style:{padding:0},title:"".concat(u("ordersMenu.address"),": ").concat(d),placement:"right",onClose:function(){n(!1)},open:t,children:(0,O.jsx)(I.Z,{spinning:!h,children:(0,O.jsx)("div",{className:"location",children:(0,O.jsx)(z.Yy,{query:{apikey:q.Z.YnxMapKey},children:(0,O.jsxs)(z.D5,{defaultState:{center:[55.751574,37.573856],zoom:12,controls:["zoomControl","fullscreenControl"]},className:"mapYandex",onClick:function(e){var t,n,a=e.get("coords");p.current?p.current.geometry.setCoordinates(a):(p.current=function(e){if(l.current)return new l.current.Placemark(e)}(a),null===(t=c.current)||void 0===t||t.geoObjects.add(p.current),null===(n=p.current)||void 0===n||n.events.add("dragend",(function(){var e;x(null===(e=p.current)||void 0===e?void 0:e.geometry.getCoordinates())})));x(a)},onLoad:function(e){e&&(l.current=e,e.ready((function(){return g(!0)})))},modules:["geoObject.addon.balloon","Placemark","geocode","geoObject.addon.hint","borders","ObjectManager","geoObject.addon.editor","control.ZoomControl","control.FullscreenControl"],children:[(0,O.jsx)(z.ah,{options:{draggable:!0},geometry:a}),(0,O.jsx)(z.Bo,{options:{float:"left"}}),(0,O.jsx)(z.Sj,{options:{float:"right"}})]})})})})})},w=n(2482),D=n.n(w),F=n(763),P=["updateData","t","productData","modalType"],Y=g.Z.Option,L={labelCol:{span:5},wrapperCol:{span:18}},_=function(e){var t,n,d=e.updateData,s=e.t,l=(e.productData,e.modalType),c=(0,m.Z)(e,P),p=(0,h.te)({isHave:!0}),f=(0,S.I0)(),b=(0,o.useState)(!1),I=(0,r.Z)(b,2),z=I[0],q=I[1],w=(0,o.useState)([]),_=(0,r.Z)(w,2),A=_[0],N=_[1],X=(0,o.useState)(""),J=(0,r.Z)(X,2),R=J[0],E=J[1],H=(0,o.useState)([]),$=(0,r.Z)(H,2),B=$[0],K=$[1],Q=x.Z.useForm(),U=(0,r.Z)(Q,1)[0],V=(0,h.kx)(),G=(0,r.Z)(V,2),W=G[0],ee=G[1],te=(0,h.qH)(),ne=(0,r.Z)(te,2),ae=ne[0],re=ne[1],oe=function(){N([]),E(""),K([]),U.resetFields()};(0,o.useEffect)((function(){if(d&&"update"===l){var e=d.data.products.map((function(e){return(0,a.Z)((0,a.Z)({},e.product),{},{quantity:e.quantity})})),t=d.data.products.map((function(e){return JSON.stringify(e.product)}));console.log("updateData: ",e),K(e),N([d.data.location.latitude,d.data.location.longitude]),E(d.data.location.address),U.setFieldsValue({productId:t})}return function(){return oe()}}),[d,l]);var ie=null===p||void 0===p||null===(t=p.data)||void 0===t||null===(n=t.data)||void 0===n?void 0:n.map((function(e){return(0,O.jsx)(Y,{value:JSON.stringify(e),children:e.name},e.id)})),de=B.reduce((function(e,t){return e+t.price*t.quantity}),0),se=(0,a.Z)({onOk:function(){U.validateFields().then((function(e){console.log("data: ",e),console.log("products: ",B);var t={data:{products:B.map((function(e){var t={};return t.productId=e.id,t.quantity=e.quantity,t})),location:{latitude:A[0],longitude:A[1],address:R}},courierId:1,clientId:1};if("update"===l)W({id:d.id,value:t}).unwrap().then((function(e){200===e.statusCode&&(i.ZP.success("Muvaffaqiyati tahrirlandi."),f((0,M.sI)({openModal:!1,modalType:""})),U.resetFields())})).catch((function(e){i.ZP.error("Xatolik yuz berdi. Xatolik: ".concat(e.message))}));else if("create"===l){ae(t).unwrap().then((function(e){200===e.statusCode&&(i.ZP.success("Muvaffaqiyati saqlandi."),f((0,M.sI)({openModal:!1,modalType:""})),oe())})).catch((function(e){i.ZP.error("Xatolik yuz berdi. Xatolik: ".concat(e.message))}))}})).catch((function(e){return console.log("Form error: ",e)}))},confirmLoading:!!l.length&&("create"===l?re.isLoading:ee.isLoading),forceRender:!0},c);return(0,O.jsx)(O.Fragment,{children:(0,O.jsxs)(y.Z,(0,a.Z)((0,a.Z)({},se),{},{children:[(0,O.jsxs)(x.Z,(0,a.Z)((0,a.Z)({},L),{},{form:U,name:"basic",layout:"horizontal",autoComplete:"off",children:[(0,O.jsx)(x.Z.Item,{name:"productId",label:s("menus.products"),rules:[{required:!0,message:s("ordersMenu.select_product")}],children:(0,O.jsx)(g.Z,{mode:"multiple",allowClear:!0,showSearch:!0,placeholder:s("ordersMenu.searchProduct"),onChange:function(e){var t=e.map((function(e){var t=B.find((function(t){return t.id===JSON.parse(e).id}));return console.log("isExist: ",t),(0,a.Z)((0,a.Z)({},JSON.parse(e)),{},{quantity:t?t.quantity:1})}));K(t)},children:ie})}),!(0,F.isEmpty)(B)&&(0,O.jsx)(x.Z.Item,{label:s("ordersMenu.choosen"),children:(0,O.jsx)(Z.ZP,{itemLayout:"horizontal",bordered:!0,size:"small",dataSource:B,footer:(0,O.jsxs)(v.Z,{direction:"vertical",size:"small",children:[(0,O.jsxs)("span",{children:[s("ordersMenu.product_type"),": ",B.length]}),(0,O.jsxs)("span",{children:[s("ordersMenu.total_sum"),": ",(0,O.jsx)(D(),{value:de,displayType:"text",thousandSeparator:!0})," (",s("ruble"),")"]})]}),renderItem:function(e){return(0,O.jsx)(Z.ZP.Item,{extra:(0,O.jsxs)(v.Z,{size:5,wrap:!0,children:[(0,O.jsx)(u.Z,{size:"small",icon:(0,O.jsx)(j.Z,{}),onClick:function(){var t;e.quantity>1&&(t=e.id,K(B.map((function(e){return e.id===t&&e.quantity--,e}))))}})," ",e.quantity,(0,O.jsx)(u.Z,{size:"small",onClick:function(){return t=e.id,void K(B.map((function(e){return e.id===t&&e.quantity++,e})));var t},icon:(0,O.jsx)(k.Z,{})})]}),actions:[(0,O.jsxs)(O.Fragment,{children:[(0,O.jsx)(D(),{value:e.price*e.quantity,displayType:"text",thousandSeparator:!0})," ","(",s("ruble"),")"]})],children:e.name})}})}),(0,O.jsx)(x.Z.Item,{name:"map",label:s("ordersMenu.address"),rules:[{required:0===A.length,message:"Xatolik"}],children:(0,O.jsxs)(u.Z,{block:!0,onClick:function(){q(!0)},children:[0===A.length?s("ordersMenu.map_point"):s("ordersMenu.edit_map_point"),(0,O.jsx)(C.Z,{})]})})]})),(0,O.jsx)(T,{open:z,setOpen:q,coords:A,setCoords:N,address:R,setAddress:E,t:s})]}))})},A=n(713),N=n(2426),X=n.n(N),J=function(){var e,t,n,m,g,x,y=(0,f.$)().t,Z=(0,S.v9)((function(e){return e.orderSlice})),v=Z.openModal,j=Z.modalType,k=(0,S.I0)(),C=(0,o.useState)({page:1,pageSize:20}),b=(0,r.Z)(C,2),I=b[0],z=b[1],q=(0,h.FA)(I),T=(0,h.OT)(I),w=(0,h.tL)(),F=(0,r.Z)(w,2),P=F[0],Y=F[1].isLoading,L=(0,o.useState)(),N=(0,r.Z)(L,2),J=N[0],R=N[1],E=[{title:"\u2116",dataIndex:"id",key:"id",width:"5%",render:function(e,t,n){return(0,O.jsx)("span",{children:n+1})}},{title:y("time"),dataIndex:"createdAt",key:"createdAt",render:function(e,t){return X()(e).format(A.i$)}},{title:(0,O.jsxs)(O.Fragment,{children:[y("productsMenu.price")," ","(",y("ruble"),")"]}),dataIndex:"total",key:"total",render:function(e,t){return(0,O.jsx)(D(),{value:e,displayType:"text",thousandSeparator:!0})}},{title:y("ordersMenu.address"),dataIndex:"data",key:"data",render:function(e,t){return e.location.address}},{title:y("actions"),key:"action",width:"20%",render:function(e,t,n){return(0,O.jsxs)(d.Z,{wrap:!1,gutter:5,children:[(0,O.jsx)(s.Z,{children:(0,O.jsx)(u.Z,{size:"small",type:"primary",ghost:!0,onClick:function(){return R(t),void k((0,M.sI)({openModal:!0,modalType:"update"}))},children:y("edit")})}),(0,O.jsx)(s.Z,{children:(0,O.jsx)(l.Z,{okText:y("yes"),cancelText:y("no"),onConfirm:function(){return t=e.id,void P({id:t}).unwrap().then((function(e){200===e.statusCode&&i.ZP.success("Muvaffaqiyati o'chirildi.")})).catch((function(e){i.ZP.error("Xatolik yuz berdi. Xatolik: ".concat(e.message))}));var t},title:y("sureDelete"),children:(0,O.jsx)(u.Z,{size:"small",danger:!0,disabled:Y,children:y("delete")})})})]})}}],H={total:(null===(e=T.data)||void 0===e||null===(t=e.meta)||void 0===t?void 0:t.total)*(null===(n=T.data)||void 0===n||null===(m=n.meta)||void 0===m?void 0:m.pagesize),page:I.page,pageSizeOptions:["20","50","100"],showQuickJumper:!0,showSizeChanger:!0,pageSize:I.pageSize,current:I.page,onChange:function(e,t){z({page:e,pageSize:t})}},$={title:y("update"===j?"edit":"add"),open:v,okText:y("update"===j?"edit":"add"),cancelText:y("close"),onCancel:function(){k((0,M.sI)({openModal:!1,modalType:""})),R(void 0)}};return(0,O.jsxs)(O.Fragment,{children:[(0,O.jsxs)(d.Z,{children:[(0,O.jsx)(s.Z,{span:20,children:(0,O.jsx)(c.Z.Title,{level:2,children:y("menus.orders")})}),(0,O.jsx)(s.Z,{span:4,children:(0,O.jsx)(u.Z,{type:"primary",onClick:function(){return k((0,M.sI)({openModal:!0,modalType:"create"}))},children:y("add")})})]}),(0,O.jsx)(p.Z,{columns:E,dataSource:null===(g=T.data)||void 0===g?void 0:g.data,loading:T.isFetching,rowKey:function(e){return e.id},pagination:H}),(0,O.jsx)(_,(0,a.Z)({updateData:J,t:y,modalType:j,productData:null===(x=q.data)||void 0===x?void 0:x.data},$))]})}}}]);
//# sourceMappingURL=868.46ebd0d9.chunk.js.map